# Salon Scheduler (RU)

Авто-расписание посетителей салона красоты с 6-месячными абонементами.

## Что умеет программа

- Рабочий день: **08:00–20:00**.
- Один сеанс: **60 минут** + **10 минут** пауза → слот **70 минут**.
- **До 10 сеансов в день**.
- Каждый посетитель имеет абонемент на **6 месяцев** и должен получить **минимум 10 сеансов** за этот период.
- Свободные слоты могут заполняться **бонусными** сеансами.
- Вы можете **добавлять/удалять** посетителей, **вносить ручные правки** (фиксировать слоты) и **перегенерировать** расписание.
- Экспорт расписания в **CSV** и **ICS (iCalendar)** для импорта в Google/Apple/Outlook Calendar.

## Установка

Требуется Python 3.9+.

```bash
pip install python-dateutil
```

(Опционально создать виртуальное окружение: `python -m venv .venv && . .venv/bin/activate`)

## Быстрый старт

Рекомендуем создать отдельный каталог данных (по умолчанию создастся `./data` рядом с `main.py`).

```bash
# 1) Добавьте посетителей (дата начала = старт абонемента на 6 месяцев)
python main.py add-visitor --name "Ирина" --start 2025-01-10
python main.py add-visitor --name "Алина" --start 2025-02-05
python main.py add-visitor --name "Мария" --start 2025-03-01

# 2) (Необязательно) забронируйте вручную некоторые слоты
python main.py block-slot --date 2025-03-15 --time 09:10 --name "Ирина" --comment "удобно клиенту"
python main.py block-slot --date 2025-03-20 --time 12:40 --comment "оборудование/мастер недоступны"

# 3) Сгенерируйте расписание на нужный период (например, весь 2025 год)
python main.py generate --start 2025-01-01 --end 2026-01-01 --fill-bonus
#   Параметр --fill-bonus заполняет свободные слоты бонусами тем,
#   кто находится в активном 6-месячном периоде.

# 4) Экспорт
python main.py export --csv schedule_2025.csv --ics schedule_2025.ics
```

Файлы данных хранятся в `./data`:
- `visitors.json` — список посетителей
- `manual_blocks.json` — ручные правки
- `schedule.json` — последнее сгенерированное расписание

При необходимости можно указать другой каталог данных:
```bash
python main.py --data-dir mydata add-visitor --name "Иван" --start 2025-04-01
python main.py --data-dir mydata generate --start 2025-01-01 --end 2026-01-01
python main.py --data-dir mydata export --csv out.csv --ics out.ics
```

## Логика планирования

1. **Ручные записи** (если указали командой `block-slot`) фиксируются первыми и не изменяются при генерации.
   - Если в ручной записи указан `--name`, такой слот засчитывается этому клиенту как обязательный.
   - Если имя не указано, слот считается **заблокированным** (недоступным).
2. **Обязательные сеансы**: каждому посетителю планируется минимум 10 сеансов в пределах его 6-месячного периода.
   - Сеансы стараются **равномерно распределить** по периоду.
   - Если день занят, ищется ближайший следующий день (при отсутствии — предыдущий).
   - Если во всём периоде нет свободных слотов, в консоль выводится предупреждение.
3. **Бонусы** (если включены `--fill-bonus`): оставшиеся свободные слоты в периоде клиентов раздаются им **равномерно**, если их абонементный период покрывает дату слота.

## Ручные правки и их влияние

- Вы можете добавлять/удалять посетителей в любое время (`add-visitor`, `remove-visitor`).
- Можно вносить точечные правки слотами (`block-slot`) — фиксируют клиента или просто блокируют время.
- После правок **перегенерируйте** расписание командой `generate`; программа учтёт ваши изменения.
- Чтобы очистить ручные записи:
```bash
python main.py clear-manual               # удалить все
python main.py clear-manual --date 2025-03-20   # удалить только за конкретную дату
```

## Формат CSV

`date;time;client;type`

- `type` = `required` (обязательный), `bonus` (бонусный), `manual` (вручную поставленный/заблокированный).

## Формат ICS

Каждый слот — отдельный `VEVENT` на 60 минут. Пауза в 10 минут автоматически остаётся свободной между событиями.

## Подсказки

- Если посетителей много, а период короткий, может не хватать слотов — программа предупредит об этом.
- Для равномерности попытайтесь распределять старты абонементов посетителей по времени (не всем в один день).
- Чтобы ограничить бонусы на человека:
```bash
python main.py generate --start 2025-01-01 --end 2026-01-01 --fill-bonus --max-bonus-per-person 5
```

## Резервное копирование

Каталог `data/` содержит все ваши данные — регулярно делайте резервную копию.

---

**Автор:** Сгенерировано ChatGPT
